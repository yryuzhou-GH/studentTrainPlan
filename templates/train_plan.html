<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="../static/css/style1.css" rel="stylesheet" type="text/css" />
    <script src="../static/js/jquery-2.2.4.min.js" type="text/javascript"></script>
    <script src="../static/js/jquery.js"></script>
    <script src="../static/js/jquery.superslide.2.1.1.js" type="text/javascript"></script>
    <script src="../static/js/actions.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>

    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="icon" href="../static/images/logo.ico" type="image/x-icon"/>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.12.5/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <title>培养计划</title>
<body>
<div class="wapper_box">
    <div class="header_box"></div>
    <div class="header_box1">
        <div class="header_box2">
            <a class="logo_box" href="{{ url_for('index') }}"><img src="../static/images/logo1.jpg"/></a>
            <ul class="nav_box">
                <li class="nav_1"><a class="nav_but" href="{{ url_for('personal_information') }}">个人中心</a></li>
                <!--251201，用户中心建设完成-->
                <li class="nav_1"><a class="nav_but" href="{{ url_for('inbox') }}">消息中心</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('news_center') }}">课程论坛</a>
                    <div class="nav_slide">
                        <div class="nav_slide1">
                            <a href="{{ url_for('news_center') }}">课程公告<span><img src="../static/images/siade_bg1.png"/></span></a>
                            <a href="{{ url_for('course_discussion') }}">课程讨论<span><img src="../static/images/siade_bg1.png"/></span></a>
                        </div>
                    </div>
                </li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('recommed') }}">课程推荐</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('course_selection') }}">选课中心</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('train_plan') }}">课程进度</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('index') }}">首页</a></li>
            </ul>
        </div>
        <script>
            $(".nav_1").mouseenter(function(){
                $(this).find(".nav_slide").slideDown()
            });
            $(".nav_1").mouseleave(function(){
                $(".nav_slide").slideUp()
            });
            //$(".producys_box").mouseout(function(){
            // $(this).find(".producys_box1").slideUp();
            //});
        </script>
    </div>
    <!--banner部分开始-->


    <!--banner部分结束-->

    <!--内容开始-->



    <!--内容结束-->

</div>

<div class="content_box_bot1">
    <ul class="content_box_bot_l">
        <div class="info_news">
            <div class="info_news_but"><p class="on">课程进度</p><p>评分</p></div>

            <div class="col-md-4">
                <ul class="info_news_text info_news_text1 ">
                    <p class="info1"> 总进度</p>
                    <div class="process-parent1">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on1">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info2"> 思想政治</p>
                    <div class="process-parent2">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on2">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info3"> 外语</p>
                    <div class="process-parent3">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on3">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info4"> 文化素质</p>
                    <div class="process-parent4">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on4">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info5"> 体育</p>
                    <div class="process-parent5">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on5">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info6"> 军事</p>
                    <div class="process-parent6">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on6">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info7"> 健康教育</p>
                    <div class="process-parent7">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on7">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info8"> 数学</p>
                    <div class="process-parent8">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on8">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info9"> 物理</p>
                    <div class="process-parent9">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on9">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info10"> 计算机</p>
                    <div class="process-parent10">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on10">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info11"> 学科基础</p>
                    <div class="process-parent11">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on11">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <p class="info12"> 专业选修</p>
                    <div class="process-parent12">
                        <div class="progress-bar bg-success" style="width:0%"><p class="on2" id="on12">0%</p>
                        </div>
                        <div class="progress-bar bg-warning" style="width:0%">
                        </div>
                    </div>
                    <div class="submit">
                        <input type="submit" onclick="submit()" value="提交 ">
                    </div>
                    <div class="reset">
                        <input type="reset" onclick="rebuild()" name="butReset" value="撤销">
                    </div>
                </ul>
            </div>

            <ul class="info_news_text info_news_text2">
                <select id="domain" style="width:220px; height: 40px">
                    <option value="">课程类别</option>
                </select>
                <p></p>
                <select id="course" style="width:220px; height: 40px">
                    <option value="">课程</option>
                </select>
                <p></p>
                <input type="text" id="score" placeholder="请输入分数(1-5)" style="width:220px; height: 40px; padding-left: 10px;">
                <p></p>
                <div class="scoreConfirm"  style="width:220px; height: 40px">
                    <input type="button" id='btnScore' value="确定评分">
                </div>
            </ul>

            <script>
                $(".info_news_but p").each(function(n){

                    $(this).click(function(){
                        $(this).addClass("on").siblings("p").removeClass("on");
                        $(".info_news_text").hide(400).eq(n).show(500);
                    });
                });

                // 获取并更新进度数据
                $(document).ready(function() {
                    // 加载课程分类
                    $.ajax({
                        url: "/api/get_course_categories",
                        type: "GET",
                        success: function(response) {
                            if (response.success) {
                                var domainSelect = $("#domain");
                                $.each(response.data, function(index, category) {
                                    domainSelect.append($("<option></option>").attr("value", category).text(category));
                                });
                            }
                        }
                    });

                    // 监听分类选择变化
                    $("#domain").change(function() {
                        var category = $(this).val();
                        var courseSelect = $("#course");
                        courseSelect.empty();
                        courseSelect.append($("<option></option>").attr("value", "").text("课程"));
                        
                        if (category) {
                            $.ajax({
                                url: "/api/get_courses_by_category",
                                type: "GET",
                                data: { category: category },
                                success: function(response) {
                                    if (response.success) {
                                        $.each(response.data, function(index, course) {
                                            courseSelect.append($("<option></option>").attr("value", course.co_no).text(course.co_name));
                                        });
                                    }
                                }
                            });
                        }
                    });

                    // 提交评分
                    $("#btnScore").click(function() {
                        var co_no = $("#course").val();
                        var score = $("#score").val();
                        
                        if (!co_no) {
                            alert("请选择课程");
                            return;
                        }
                        if (!score) {
                            alert("请输入分数");
                            return;
                        }
                        // 简单的分数验证 1-5
                        if (isNaN(score) || score < 1 || score > 5) {
                            alert("请输入1-5之间的有效分数");
                            return;
                        }

                        $.ajax({
                            url: "/api/submit_course_score",
                            type: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ co_no: co_no, score: score }),
                            success: function(response) {
                                if (response.success) {
                                    alert("评分成功！");
                                    // 可以在这里清空输入或刷新进度等
                                    $("#score").val("");
                                } else {
                                    alert("评分失败: " + response.message);
                                }
                            },
                            error: function(xhr) {
                                var msg = "请求失败";
                                if (xhr.responseJSON && xhr.responseJSON.message) {
                                    msg = xhr.responseJSON.message;
                                }
                                alert(msg);
                            }
                        });
                    });

                    // 加载进度条数据
                    $.ajax({
                        url: "/api/get_progress",
                        type: "GET",
                        success: function(response) {
                            if (response.success && response.data) {
                                var data = response.data;
                                
                                // 定义前端显示的分类名称与HTML中class的映射关系（或者直接遍历）
                                // 观察HTML结构：
                                // 总进度: .info1, .process-parent1
                                // 思想政治: .info2, .process-parent2
                                // 外语: .info3, .process-parent3
                                // ...
                                
                                var categoryMap = {
                                    '总进度': 1,
                                    '思想政治': 2,
                                    '外语': 3,
                                    '文化素质': 4,
                                    '体育': 5,
                                    '军事': 6,
                                    '健康教育': 7,
                                    '数学': 8,
                                    '物理': 9,
                                    '计算机': 10,
                                    '学科基础': 11,
                                    '专业选修': 12
                                };
                                
                                for (var key in data) {
                                    if (categoryMap.hasOwnProperty(key)) {
                                        var index = categoryMap[key];
                                        var percentage = data[key].percentage;
                                        var text = percentage + "%";
                                        
                                        // 更新进度条宽度
                                        $(".process-parent" + index + " .progress-bar.bg-success").css("width", percentage + "%");
                                        
                                        // 更新文本
                                        $("#on" + index).text(text);
                                    }
                                }
                            } else {
                                console.error("获取进度数据失败:", response.message);
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error("请求失败:", error);
                        }
                    });
                });
            </script>
            <script  type="text/javascript">
                window.onload = function(){
                    initScore();
                };
            </script>

        </div>
    </ul>
    <div id="container" style="width:1600px; height:750px;position: absolute; margin-top:0px; margin-left:310px;"></div>
    <script type="text/javascript" src="../static/js/Tree.js"></script>

</div>
</body>

</html>